<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Lecture Transcriber + Gemini AI</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f9; color: #333; }
h1 { color: #4a90e2; }
button { margin: 5px; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; background: #4a90e2; color: white; }
button:hover { background: #357abd; }
textarea { width: 100%; height: 150px; margin-top: 10px; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
input[type="file"], input[type="text"], input[type="password"] { width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; }
</style>
</head>
<body>
     <script type="importmap">
        {
          "imports": {
            "@google/generative-ai": "https://esm.run/@google/generative-ai"
          }
        }
      </script>
<h1>Lecture Recorder + Gemini AI</h1>

<label>Gemini API Key:</label>
<input type="password" id="apiKeyInput" placeholder="Enter and save once">
<button onclick="saveApiKey()">Save Key</button>

<h2>Record Audio</h2>
<button id="recordBtn">üéôÔ∏è Start Recording</button>
<button id="stopBtn" disabled>‚èπÔ∏è Stop Recording</button>

<h2>Upload MP3</h2>
<input type="file" id="fileInput" accept="audio/mp3">

<h2>Transcription</h2>
<button onclick="transcribeAudio()">Transcribe Audio</button>
<textarea id="transcription" placeholder="Transcription will appear here..."></textarea>

<h2>AI Actions</h2>
<input type="text" id="question" placeholder="Ask a question about the lecture">
<button onclick="askAI()">Ask Question</button>
<button onclick="summarizeLecture()">Summarize Lecture</button>
<textarea id="aiOutput" placeholder="AI output will appear here..."></textarea>

<button onclick="downloadNotes()">Download Notes</button>

<script type="module">
     import { GoogleGenerativeAI } from "@google/generative-ai";

      // Fetch your API_KEY
      const genAI = new GoogleGenerativeAI(localStorage.getItem("GEMINI_API_KEY"));
const model = genAI.getGenerativeModel({ model: "gemini-2.5-pro" });


let mediaRecorder, audioChunks = [], audioBlob = null;

// Load saved API key
document.getElementById("apiKeyInput").value = localStorage.getItem("GEMINI_API_KEY") || "";
function saveApiKey() {
    localStorage.setItem("GEMINI_API_KEY", document.getElementById("apiKeyInput").value);
    alert("API Key saved locally!");
}

// Recording
const recordBtn = document.getElementById("recordBtn");
const stopBtn = document.getElementById("stopBtn");

recordBtn.onclick = async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    audioChunks = [];
    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
    mediaRecorder.onstop = () => { audioBlob = new Blob(audioChunks, { type: 'audio/mp3' }); };
    mediaRecorder.start();
    recordBtn.disabled = true;
    stopBtn.disabled = false;
};

stopBtn.onclick = () => {
    mediaRecorder.stop();
    recordBtn.disabled = false;
    stopBtn.disabled = true;
};

// Upload
document.getElementById("fileInput").addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (file) audioBlob = file;
});

// Gemini transcription
async function transcribeAudio() {
    if (!audioBlob) { alert("Record or upload an audio file first!"); return; }
    const apiKey = localStorage.getItem("GEMINI_API_KEY");
    if (!apiKey) { alert("Please save your Gemini API key first."); return; }

    const reader = new FileReader();
    reader.onloadend = async () => {
        const base64Audio = reader.result.split(",")[1];
        const requestBody = {
            contents: [{
                parts: [
                    { file_data: { mime_type: audioBlob.type || "audio/mp3", file_uri: "data:audio/mp3;base64," + base64Audio } },
                    { text: "Transcribe this audio accurately." }
                ]
            }]
        };
       var resp = model.generateContent(requestBody);
            const data = await resp.json();
            document.getElementById("transcription").value = data.candidates?.[0]?.content?.parts?.[0]?.text || "‚ùå Transcription failed.";
       
    };
    reader.readAsDataURL(audioBlob);
}

// Gemini AI helper
async function geminiPrompt(prompt) {
    const apiKey = localStorage.getItem("GEMINI_API_KEY");
    if (!apiKey) { alert("Please save your Gemini API key first."); return; }
    try {
        const resp = model.generateContent({text: prompt});
        const data = await resp.json();
        return data?.candidates?.[0]?.content?.parts?.[0]?.text || "No response.";
    } catch (err) {
        console.error(err);
        return "AI request failed.";
    }
}

// Ask question
async function askAI() {
    const transcript = document.getElementById("transcription").value.trim();
    const q = document.getElementById("question").value.trim();
    if (!transcript || !q) { alert("Transcription and question required."); return; }
    const prompt = `Answer this question based on the transcript only:\nTranscript:\n${transcript}\nQuestion: ${q}`;
    const answer = await geminiPrompt(prompt);
    document.getElementById("aiOutput").value = answer;
}

// Summarize
async function summarizeLecture() {
    const transcript = document.getElementById("transcription").value.trim();
    if (!transcript) { alert("No transcript to summarize."); return; }
    const prompt = `Summarize the lecture into concise notes, 5‚Äì10 bullet points, key terms, and two quiz questions with answers:\n${transcript}`;
    const summary = await geminiPrompt(prompt);
    document.getElementById("aiOutput").value = summary;
}

// Download notes
function downloadNotes() {
    const content = `=== Transcript ===\n${document.getElementById("transcription").value}\n\n=== AI Output ===\n${document.getElementById("aiOutput").value}`;
    const blob = new Blob([content], { type: "text/plain" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a"); a.href = url; a.download = "lecture_notes.txt"; a.click();
    URL.revokeObjectURL(url);
}
</script>
</body>
</html>